<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2200 2600" width="2200" height="2600">
  <defs>
    <linearGradient id="archHeader" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1565c0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#42a5f5;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="expertGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#7e57c2;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#5e35b1;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="routerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ff7043;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e64a19;stop-opacity:1" />
    </linearGradient>
    <filter id="shadowArch" x="-5%" y="-5%" width="110%" height="110%">
      <feDropShadow dx="3" dy="3" stdDeviation="4" flood-opacity="0.3"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="2200" height="2600" fill="#FAFAFA"/>
  
  <!-- Title Header -->
  <rect x="50" y="40" width="2100" height="100" rx="15" fill="url(#archHeader)" filter="url(#shadowArch)"/>
  <text x="1100" y="105" font-family="Arial, sans-serif" font-size="48" font-weight="bold" fill="white" text-anchor="middle">
    LLaDA-MoE Architecture: MoE Transformer Layer
  </text>
  
  <!-- Architecture Parameters -->
  <rect x="50" y="180" width="2100" height="180" rx="12" fill="#e8eaf6" stroke="#5c6bc0" stroke-width="3" filter="url(#shadowArch)"/>
  <text x="90" y="230" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#000000">
    üìê Architecture Specifications
  </text>
  
  <!-- Specs grid -->
  <rect x="90" y="260" width="240" height="80" rx="8" fill="#c5cae9" stroke="#3f51b5" stroke-width="2"/>
  <text x="210" y="295" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Layers</text>
  <text x="210" y="325" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#1a237e" text-anchor="middle">16</text>
  
  <rect x="360" y="260" width="240" height="80" rx="8" fill="#c5cae9" stroke="#3f51b5" stroke-width="2"/>
  <text x="480" y="295" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Hidden Dim</text>
  <text x="480" y="325" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#1a237e" text-anchor="middle">2048</text>
  
  <rect x="630" y="260" width="240" height="80" rx="8" fill="#c5cae9" stroke="#3f51b5" stroke-width="2"/>
  <text x="750" y="295" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Attn Heads</text>
  <text x="750" y="325" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#1a237e" text-anchor="middle">16</text>
  
  <rect x="900" y="260" width="240" height="80" rx="8" fill="#e1bee7" stroke="#7b1fa2" stroke-width="2"/>
  <text x="1020" y="295" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Total Experts</text>
  <text x="1020" y="325" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#4a148c" text-anchor="middle">64</text>
  
  <rect x="1170" y="260" width="260" height="80" rx="8" fill="#c8e6c9" stroke="#2e7d32" stroke-width="2"/>
  <text x="1300" y="295" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Active Experts</text>
  <text x="1300" y="325" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#1b5e20" text-anchor="middle">8 (top-k)</text>
  
  <rect x="1460" y="260" width="240" height="80" rx="8" fill="#c5cae9" stroke="#3f51b5" stroke-width="2"/>
  <text x="1580" y="295" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Expert Dim</text>
  <text x="1580" y="325" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#1a237e" text-anchor="middle">1024</text>
  
  <rect x="1730" y="260" width="240" height="80" rx="8" fill="#ffe0b2" stroke="#f57c00" stroke-width="2"/>
  <text x="1850" y="295" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">RoPE Base</text>
  <text x="1850" y="325" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#e65100" text-anchor="middle">50,000</text>
  
  <!-- MoE Layer Architecture -->
  <rect x="50" y="400" width="2100" height="900" rx="12" fill="#fff3e0" stroke="#ff9800" stroke-width="3" filter="url(#shadowArch)"/>
  <text x="90" y="460" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#000000">
    üèóÔ∏è MoE Transformer Layer Architecture
  </text>
  
  <!-- Input -->
  <rect x="950" y="500" width="300" height="60" rx="10" fill="#90caf9" stroke="#1565c0" stroke-width="3"/>
  <text x="1100" y="540" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#000000" text-anchor="middle">Input Tokens</text>
  
  <!-- Arrow -->
  <line x1="1100" y1="560" x2="1100" y2="610" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- RMSNorm -->
  <rect x="950" y="620" width="300" height="50" rx="8" fill="#b39ddb" stroke="#7e57c2" stroke-width="2"/>
  <text x="1100" y="655" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">RMSNorm</text>
  
  <!-- Arrow -->
  <line x1="1100" y1="670" x2="1100" y2="720" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Multi-Head Attention -->
  <rect x="850" y="730" width="500" height="100" rx="10" fill="#81d4fa" stroke="#0288d1" stroke-width="3"/>
  <text x="1100" y="775" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#000000" text-anchor="middle">Multi-Head Attention</text>
  <text x="1100" y="810" font-family="Arial, sans-serif" font-size="18" fill="#000000" text-anchor="middle">with QK-LayerNorm + RoPE</text>
  
  <!-- Residual connection -->
  <path d="M 850 580 L 750 580 L 750 780 L 850 780" fill="none" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="720" y="680" font-family="Arial, sans-serif" font-size="16" fill="#666" text-anchor="middle" transform="rotate(-90, 720, 680)">+ residual</text>
  
  <!-- Arrow -->
  <line x1="1100" y1="830" x2="1100" y2="880" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- RMSNorm 2 -->
  <rect x="950" y="890" width="300" height="50" rx="8" fill="#b39ddb" stroke="#7e57c2" stroke-width="2"/>
  <text x="1100" y="925" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">RMSNorm</text>
  
  <!-- Arrow to Router -->
  <line x1="1100" y1="940" x2="1100" y2="990" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Router -->
  <rect x="900" y="1000" width="400" height="80" rx="10" fill="url(#routerGrad)" filter="url(#shadowArch)"/>
  <text x="1100" y="1040" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="white" text-anchor="middle">Router</text>
  <text x="1100" y="1070" font-family="Arial, sans-serif" font-size="18" fill="white" text-anchor="middle">Selects Top-8 of 64 Experts</text>
  
  <!-- Arrows to experts -->
  <line x1="920" y1="1080" x2="200" y2="1150" stroke="#e64a19" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1000" y1="1080" x2="600" y2="1150" stroke="#e64a19" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1100" y1="1080" x2="1100" y2="1150" stroke="#e64a19" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1200" y1="1080" x2="1600" y2="1150" stroke="#e64a19" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1280" y1="1080" x2="2000" y2="1150" stroke="#e64a19" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Experts -->
  <rect x="100" y="1160" width="180" height="100" rx="10" fill="url(#expertGrad)" filter="url(#shadowArch)"/>
  <text x="190" y="1200" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white" text-anchor="middle">Expert 1</text>
  <text x="190" y="1230" font-family="Arial, sans-serif" font-size="16" fill="white" text-anchor="middle">SwiGLU FFN</text>
  <text x="190" y="1250" font-family="Arial, sans-serif" font-size="14" fill="#e1bee7" text-anchor="middle">dim=1024</text>
  
  <rect x="500" y="1160" width="180" height="100" rx="10" fill="url(#expertGrad)" filter="url(#shadowArch)"/>
  <text x="590" y="1200" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white" text-anchor="middle">Expert 2</text>
  <text x="590" y="1230" font-family="Arial, sans-serif" font-size="16" fill="white" text-anchor="middle">SwiGLU FFN</text>
  <text x="590" y="1250" font-family="Arial, sans-serif" font-size="14" fill="#e1bee7" text-anchor="middle">dim=1024</text>
  
  <text x="850" y="1210" font-family="Arial, sans-serif" font-size="36" fill="#5e35b1" text-anchor="middle">...</text>
  
  <rect x="1010" y="1160" width="180" height="100" rx="10" fill="url(#expertGrad)" filter="url(#shadowArch)"/>
  <text x="1100" y="1200" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white" text-anchor="middle">Expert k</text>
  <text x="1100" y="1230" font-family="Arial, sans-serif" font-size="16" fill="white" text-anchor="middle">SwiGLU FFN</text>
  <text x="1100" y="1250" font-family="Arial, sans-serif" font-size="14" fill="#e1bee7" text-anchor="middle">dim=1024</text>
  
  <text x="1350" y="1210" font-family="Arial, sans-serif" font-size="36" fill="#5e35b1" text-anchor="middle">...</text>
  
  <rect x="1510" y="1160" width="180" height="100" rx="10" fill="#9e9e9e" stroke="#616161" stroke-width="2"/>
  <text x="1600" y="1200" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white" text-anchor="middle">Expert 63</text>
  <text x="1600" y="1230" font-family="Arial, sans-serif" font-size="14" fill="white" text-anchor="middle">(inactive)</text>
  
  <rect x="1910" y="1160" width="180" height="100" rx="10" fill="#9e9e9e" stroke="#616161" stroke-width="2"/>
  <text x="2000" y="1200" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="white" text-anchor="middle">Expert 64</text>
  <text x="2000" y="1230" font-family="Arial, sans-serif" font-size="14" fill="white" text-anchor="middle">(inactive)</text>
  
  <!-- Legend for active/inactive -->
  <rect x="1510" y="1120" width="15" height="15" fill="#5e35b1"/>
  <text x="1535" y="1133" font-family="Arial, sans-serif" font-size="14" fill="#000000">Active (top-8)</text>
  <rect x="1680" y="1120" width="15" height="15" fill="#9e9e9e"/>
  <text x="1705" y="1133" font-family="Arial, sans-serif" font-size="14" fill="#000000">Inactive (56)</text>
  
  <!-- Weighted combination -->
  <line x1="190" y1="1260" x2="1100" y2="1300" stroke="#5e35b1" stroke-width="2"/>
  <line x1="590" y1="1260" x2="1100" y2="1300" stroke="#5e35b1" stroke-width="2"/>
  <line x1="1100" y1="1260" x2="1100" y2="1300" stroke="#5e35b1" stroke-width="2"/>
  
  <!-- Combine box -->
  <ellipse cx="1100" cy="1320" rx="100" ry="30" fill="#c8e6c9" stroke="#2e7d32" stroke-width="2"/>
  <text x="1100" y="1328" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Œ£ weighted</text>
  
  <!-- Output -->
  <line x1="1100" y1="1350" x2="1100" y2="1400" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Final residual -->
  <path d="M 1350 940 L 1450 940 L 1450 1420 L 1350 1420" fill="none" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="1480" y="1180" font-family="Arial, sans-serif" font-size="16" fill="#666" text-anchor="middle" transform="rotate(90, 1480, 1180)">+ residual</text>
  
  <!-- Output -->
  <rect x="950" y="1410" width="300" height="60" rx="10" fill="#a5d6a7" stroke="#2e7d32" stroke-width="3"/>
  <text x="1100" y="1450" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#000000" text-anchor="middle">Layer Output</text>
  
  <!-- Router Detail Section -->
  <rect x="50" y="1520" width="2100" height="480" rx="12" fill="#e1f5fe" stroke="#0288d1" stroke-width="3" filter="url(#shadowArch)"/>
  <text x="90" y="1580" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#000000">
    üéØ Router Mechanism: How Top-K Expert Selection Works
  </text>
  
  <!-- Token input -->
  <rect x="90" y="1620" width="200" height="60" rx="8" fill="#90caf9" stroke="#1565c0" stroke-width="2"/>
  <text x="190" y="1660" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">Token h</text>
  
  <!-- Arrow -->
  <line x1="290" y1="1650" x2="350" y2="1650" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Router linear -->
  <rect x="360" y="1620" width="250" height="60" rx="8" fill="#ffcc80" stroke="#f57c00" stroke-width="2"/>
  <text x="485" y="1660" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Router Linear</text>
  
  <!-- Arrow -->
  <line x1="610" y1="1650" x2="670" y2="1650" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Softmax -->
  <rect x="680" y="1620" width="180" height="60" rx="8" fill="#ffcc80" stroke="#f57c00" stroke-width="2"/>
  <text x="770" y="1660" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Softmax</text>
  
  <!-- Arrow -->
  <line x1="860" y1="1650" x2="920" y2="1650" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Top-K selection -->
  <rect x="930" y="1620" width="200" height="60" rx="8" fill="url(#routerGrad)"/>
  <text x="1030" y="1660" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="white" text-anchor="middle">Top-8 Select</text>
  
  <!-- Outputs -->
  <line x1="1130" y1="1650" x2="1200" y2="1650" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <rect x="1210" y="1600" width="400" height="100" rx="8" fill="#c8e6c9" stroke="#2e7d32" stroke-width="2"/>
  <text x="1410" y="1640" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Expert Indices: [3, 7, 12, 19, 25, 41, 52, 60]</text>
  <text x="1410" y="1680" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">Weights: [0.18, 0.15, 0.14, 0.12, ...]</text>
  
  <!-- Formula -->
  <rect x="90" y="1720" width="2020" height="100" rx="10" fill="#b3e5fc" stroke="#0277bd" stroke-width="2"/>
  <text x="130" y="1765" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#000000">Router Formula:</text>
  <text x="130" y="1805" font-family="Times New Roman, serif" font-size="26" fill="#000000">
    G(h) = TopK(Softmax(W_r ¬∑ h), k=8)  ‚Üí  Output = Œ£·µ¢ g·µ¢ ¬∑ Expert·µ¢(h)  where g·µ¢ = routing weight
  </text>
  
  <!-- Load balancing -->
  <rect x="90" y="1840" width="1000" height="130" rx="10" fill="#fff8e1" stroke="#ffc107" stroke-width="2"/>
  <text x="130" y="1885" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000">Load Balancing Loss:</text>
  <text x="130" y="1925" font-family="Arial, sans-serif" font-size="20" fill="#000000">‚Ä¢ Auxiliary loss to prevent routing collapse</text>
  <text x="130" y="1955" font-family="Arial, sans-serif" font-size="20" fill="#000000">‚Ä¢ Ensures all experts are utilized evenly</text>
  
  <rect x="1110" y="1840" width="1000" height="130" rx="10" fill="#ffecb3" stroke="#ff8f00" stroke-width="2"/>
  <text x="1150" y="1885" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000">Per-Expert Capacity:</text>
  <text x="1150" y="1925" font-family="Arial, sans-serif" font-size="20" fill="#000000">‚Ä¢ Limits tokens per expert per batch</text>
  <text x="1150" y="1955" font-family="Arial, sans-serif" font-size="20" fill="#000000">‚Ä¢ Prevents memory issues and ensures efficiency</text>
  
  <!-- Key Components Summary -->
  <rect x="50" y="2040" width="2100" height="250" rx="12" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="3" filter="url(#shadowArch)"/>
  <text x="90" y="2100" font-family="Arial, sans-serif" font-size="32" font-weight="bold" fill="#000000">
    üîß Key Architecture Components
  </text>
  
  <rect x="90" y="2130" width="480" height="130" rx="10" fill="#e1bee7" stroke="#9c27b0" stroke-width="2"/>
  <text x="330" y="2175" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">RMSNorm</text>
  <text x="330" y="2210" font-family="Arial, sans-serif" font-size="18" fill="#000000" text-anchor="middle">Efficient normalization</text>
  <text x="330" y="2240" font-family="Arial, sans-serif" font-size="18" fill="#000000" text-anchor="middle">without mean centering</text>
  
  <rect x="600" y="2130" width="480" height="130" rx="10" fill="#e1bee7" stroke="#9c27b0" stroke-width="2"/>
  <text x="840" y="2175" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">SwiGLU Activation</text>
  <text x="840" y="2210" font-family="Arial, sans-serif" font-size="18" fill="#000000" text-anchor="middle">Gated linear unit with</text>
  <text x="840" y="2240" font-family="Arial, sans-serif" font-size="18" fill="#000000" text-anchor="middle">Swish activation</text>
  
  <rect x="1110" y="2130" width="480" height="130" rx="10" fill="#e1bee7" stroke="#9c27b0" stroke-width="2"/>
  <text x="1350" y="2175" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">RoPE Embeddings</text>
  <text x="1350" y="2210" font-family="Arial, sans-serif" font-size="18" fill="#000000" text-anchor="middle">Rotary position encoding</text>
  <text x="1350" y="2240" font-family="Arial, sans-serif" font-size="18" fill="#000000" text-anchor="middle">Base: 50,000</text>
  
  <rect x="1620" y="2130" width="490" height="130" rx="10" fill="#e1bee7" stroke="#9c27b0" stroke-width="2"/>
  <text x="1865" y="2175" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">QK-LayerNorm</text>
  <text x="1865" y="2210" font-family="Arial, sans-serif" font-size="18" fill="#000000" text-anchor="middle">Stabilizes attention</text>
  <text x="1865" y="2240" font-family="Arial, sans-serif" font-size="18" fill="#000000" text-anchor="middle">Q and K projections</text>
  
  <!-- Footer -->
  <rect x="50" y="2330" width="2100" height="230" rx="12" fill="#37474f" filter="url(#shadowArch)"/>
  <text x="1100" y="2385" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="white" text-anchor="middle">
    Efficiency Analysis: Why MoE Works for Diffusion
  </text>
  <text x="250" y="2440" font-family="Arial, sans-serif" font-size="22" fill="#b0bec5">Dense 8B: 8B params activated per token</text>
  <text x="800" y="2440" font-family="Arial, sans-serif" font-size="22" fill="#a5d6a7">MoE 7B: Only 1.4B params activated!</text>
  <text x="1400" y="2440" font-family="Arial, sans-serif" font-size="22" fill="#81d4fa">= 5.7x fewer FLOPs per forward pass</text>
  <text x="1100" y="2500" font-family="Arial, sans-serif" font-size="20" fill="#78909c" text-anchor="middle">
    With diffusion's multiple denoising steps, this efficiency gain multiplies significantly!
  </text>
</svg>


