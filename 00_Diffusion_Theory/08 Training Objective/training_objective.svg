<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2200 5000" width="2200" height="5000">
  <defs>
    <linearGradient id="headerGrad8" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4A148C;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6A1B9A;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="elboGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#EDE7F6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D1C4E9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="lossGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E3F2FD;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#BBDEFB;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="simplifiedGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E8F5E9;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C8E6C9;stop-opacity:1" />
    </linearGradient>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6A1B9A"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="2200" height="5000" fill="#FAFBFC"/>
  
  <!-- Main Title Box -->
  <rect x="50" y="40" width="2100" height="120" rx="15" fill="url(#headerGrad8)" stroke="#4A148C" stroke-width="4"/>
  <text x="1100" y="115" font-family="Georgia, serif" font-size="52" font-weight="bold" fill="#FFFFFF" text-anchor="middle">TRAINING OBJECTIVE - ELBO DERIVATION</text>
  
  <!-- VISUAL DIAGRAM 1: Training Overview -->
  <rect x="50" y="200" width="2100" height="480" rx="12" fill="#FFFFFF" stroke="#6A1B9A" stroke-width="3"/>
  <text x="1100" y="260" font-family="Georgia, serif" font-size="36" font-weight="bold" fill="#000000" text-anchor="middle">Training Pipeline Visualization</text>
  
  <!-- Training loop diagram -->
  <!-- Data -->
  <rect x="120" y="320" width="180" height="100" rx="15" fill="#E8F5E9" stroke="#2E7D32" stroke-width="3"/>
  <text x="210" y="360" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">Data x₀</text>
  <text x="210" y="390" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2E7D32" text-anchor="middle">~ p_data</text>
  
  <!-- Arrow -->
  <line x1="300" y1="370" x2="380" y2="370" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Sample t -->
  <rect x="400" y="320" width="140" height="100" rx="15" fill="#FFF3E0" stroke="#EF6C00" stroke-width="3"/>
  <text x="470" y="360" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">Sample t</text>
  <text x="470" y="390" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#EF6C00" text-anchor="middle">~ U(1,T)</text>
  
  <!-- Arrow -->
  <line x1="540" y1="370" x2="620" y2="370" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Sample noise -->
  <rect x="640" y="320" width="160" height="100" rx="15" fill="#E3F2FD" stroke="#1565C0" stroke-width="3"/>
  <text x="720" y="360" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">Sample ε</text>
  <text x="720" y="390" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#1565C0" text-anchor="middle">~ N(0, I)</text>
  
  <!-- Arrow -->
  <line x1="800" y1="370" x2="880" y2="370" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Create noisy -->
  <rect x="900" y="300" width="200" height="140" rx="15" fill="#FCE4EC" stroke="#C62828" stroke-width="3"/>
  <text x="1000" y="350" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">Create x_t</text>
  <text x="1000" y="385" font-family="Times New Roman, serif" font-size="16" font-weight="bold" fill="#C62828" text-anchor="middle">x_t = √ᾱ_t x₀</text>
  <text x="1000" y="415" font-family="Times New Roman, serif" font-size="16" font-weight="bold" fill="#C62828" text-anchor="middle">+ √(1-ᾱ_t) ε</text>
  
  <!-- Arrow -->
  <line x1="1100" y1="370" x2="1180" y2="370" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Neural Network -->
  <rect x="1200" y="300" width="200" height="140" rx="15" fill="url(#elboGrad)" stroke="#6A1B9A" stroke-width="3"/>
  <text x="1300" y="355" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">Network</text>
  <text x="1300" y="390" font-family="Times New Roman, serif" font-size="20" font-weight="bold" fill="#6A1B9A" text-anchor="middle">ε_θ(x_t, t)</text>
  
  <!-- Arrow -->
  <line x1="1400" y1="370" x2="1480" y2="370" stroke="#333" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Loss -->
  <rect x="1500" y="300" width="200" height="140" rx="15" fill="#FFEBEE" stroke="#D32F2F" stroke-width="3"/>
  <text x="1600" y="350" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">Loss</text>
  <text x="1600" y="390" font-family="Times New Roman, serif" font-size="20" font-weight="bold" fill="#D32F2F" text-anchor="middle">||ε - ε̂||²</text>
  
  <!-- Backprop arrow -->
  <path d="M 1700 370 L 1800 370 L 1800 520 L 1300 520 L 1300 450" stroke="#D32F2F" stroke-width="3" fill="none" stroke-dasharray="10,5" marker-end="url(#arrow)"/>
  <text x="1550" y="550" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#D32F2F" text-anchor="middle">Backpropagate & Update θ</text>
  
  <!-- Visual: What the loss measures -->
  <rect x="120" y="480" width="400" height="150" rx="10" fill="#FAFAFA" stroke="#666" stroke-width="2"/>
  <text x="320" y="520" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">Target: Actual Noise ε</text>
  <!-- Noise pattern -->
  <circle cx="180" cy="570" r="5" fill="#666"/>
  <circle cx="220" cy="560" r="4" fill="#888"/>
  <circle cx="260" cy="580" r="6" fill="#666"/>
  <circle cx="300" cy="555" r="4" fill="#777"/>
  <circle cx="340" cy="575" r="5" fill="#888"/>
  <circle cx="380" cy="565" r="4" fill="#666"/>
  <circle cx="420" cy="585" r="5" fill="#777"/>
  <circle cx="460" cy="560" r="4" fill="#888"/>
  
  <text x="540" y="560" font-family="Arial, sans-serif" font-size="30" font-weight="bold" fill="#D32F2F">≈</text>
  
  <rect x="580" y="480" width="400" height="150" rx="10" fill="#FAFAFA" stroke="#666" stroke-width="2"/>
  <text x="780" y="520" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">Prediction: ε̂_θ(x_t, t)</text>
  <!-- Similar noise pattern -->
  <circle cx="640" cy="572" r="5" fill="#6A1B9A"/>
  <circle cx="680" cy="558" r="4" fill="#9C27B0"/>
  <circle cx="720" cy="582" r="6" fill="#6A1B9A"/>
  <circle cx="760" cy="553" r="4" fill="#AB47BC"/>
  <circle cx="800" cy="577" r="5" fill="#9C27B0"/>
  <circle cx="840" cy="563" r="4" fill="#6A1B9A"/>
  <circle cx="880" cy="587" r="5" fill="#AB47BC"/>
  <circle cx="920" cy="558" r="4" fill="#9C27B0"/>
  
  <!-- SECTION 2: ELBO Derivation -->
  <rect x="50" y="720" width="2100" height="900" rx="12" fill="url(#elboGrad)" stroke="#6A1B9A" stroke-width="3"/>
  <text x="80" y="780" font-family="Georgia, serif" font-size="36" font-weight="bold" fill="#000000">1. Evidence Lower Bound (ELBO) Derivation</text>
  
  <!-- Visual: ELBO concept -->
  <rect x="100" y="830" width="600" height="400" rx="10" fill="#FFFFFF" stroke="#6A1B9A" stroke-width="2"/>
  <text x="400" y="870" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#000000" text-anchor="middle">ELBO Visual Intuition</text>
  
  <!-- Draw probability distribution -->
  <path d="M 150 1150 Q 200 1100 300 900 Q 400 1050 500 1000 Q 600 1100 650 1150" stroke="#6A1B9A" stroke-width="3" fill="none"/>
  <text x="400" y="1200" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#6A1B9A" text-anchor="middle">True log p(x₀)</text>
  
  <!-- ELBO bar -->
  <rect x="200" y="1000" width="400" height="30" fill="#D1C4E9" stroke="#6A1B9A" stroke-width="2"/>
  <text x="400" y="1070" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#4A148C" text-anchor="middle">ELBO (lower bound)</text>
  
  <!-- Arrow showing gap -->
  <line x1="600" y1="960" x2="600" y2="1015" stroke="#D32F2F" stroke-width="2"/>
  <text x="660" y="990" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#D32F2F">Gap = KL</text>
  
  <!-- Mathematical derivation on right -->
  <rect x="750" y="830" width="1350" height="750" rx="10" fill="#FFFFFF" stroke="#6A1B9A" stroke-width="2"/>
  <text x="780" y="880" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#000000">Step-by-Step ELBO Derivation:</text>
  
  <text x="800" y="930" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1a1a1a">Step 1: Start with log-likelihood</text>
  <rect x="820" y="950" width="700" height="50" rx="8" fill="#EDE7F6" stroke="#6A1B9A" stroke-width="1"/>
  <text x="1170" y="985" font-family="Times New Roman, serif" font-size="24" font-weight="bold" fill="#000000" text-anchor="middle">log p_θ(x₀) = log ∫ p_θ(x_{0:T}) dx_{1:T}</text>
  
  <text x="800" y="1040" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1a1a1a">Step 2: Introduce variational distribution q</text>
  <rect x="820" y="1060" width="900" height="50" rx="8" fill="#EDE7F6" stroke="#6A1B9A" stroke-width="1"/>
  <text x="1270" y="1095" font-family="Times New Roman, serif" font-size="24" font-weight="bold" fill="#000000" text-anchor="middle">= log ∫ p_θ(x_{0:T}) · q(x_{1:T}|x₀)/q(x_{1:T}|x₀) dx_{1:T}</text>
  
  <text x="800" y="1150" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1a1a1a">Step 3: Apply Jensen's inequality (log is concave)</text>
  <rect x="820" y="1170" width="900" height="50" rx="8" fill="#EDE7F6" stroke="#6A1B9A" stroke-width="1"/>
  <text x="1270" y="1205" font-family="Times New Roman, serif" font-size="24" font-weight="bold" fill="#000000" text-anchor="middle">≥ ∫ q(x_{1:T}|x₀) log[p_θ(x_{0:T})/q(x_{1:T}|x₀)] dx_{1:T}</text>
  
  <text x="800" y="1260" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1a1a1a">Step 4: This is the ELBO!</text>
  <rect x="820" y="1280" width="1200" height="60" rx="8" fill="#D1C4E9" stroke="#6A1B9A" stroke-width="2"/>
  <text x="1420" y="1320" font-family="Times New Roman, serif" font-size="26" font-weight="bold" fill="#000000" text-anchor="middle">ELBO = E_q[log p_θ(x_{0:T}) - log q(x_{1:T}|x₀)]</text>
  
  <text x="800" y="1400" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1a1a1a">Step 5: Expand using Markov property</text>
  <rect x="820" y="1420" width="1200" height="80" rx="8" fill="#EDE7F6" stroke="#6A1B9A" stroke-width="1"/>
  <text x="1420" y="1455" font-family="Times New Roman, serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">p_θ(x_{0:T}) = p(x_T) ∏_{t=1}^T p_θ(x_{t-1}|x_t)</text>
  <text x="1420" y="1490" font-family="Times New Roman, serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">q(x_{1:T}|x₀) = ∏_{t=1}^T q(x_t|x_{t-1})</text>
  
  <!-- Visual: Loss decomposition -->
  <rect x="100" y="1250" width="600" height="300" rx="10" fill="#FFFFFF" stroke="#6A1B9A" stroke-width="2"/>
  <text x="400" y="1290" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">ELBO Decomposes Into:</text>
  
  <!-- Three components -->
  <rect x="140" y="1330" width="160" height="80" rx="8" fill="#FFCDD2" stroke="#D32F2F" stroke-width="2"/>
  <text x="220" y="1365" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#000000" text-anchor="middle">L_T</text>
  <text x="220" y="1395" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#D32F2F" text-anchor="middle">Prior Loss</text>
  
  <text x="330" y="1375" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#000">+</text>
  
  <rect x="360" y="1330" width="160" height="80" rx="8" fill="#C5CAE9" stroke="#3F51B5" stroke-width="2"/>
  <text x="440" y="1365" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#000000" text-anchor="middle">Σ L_{t-1}</text>
  <text x="440" y="1395" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#3F51B5" text-anchor="middle">Denoising</text>
  
  <text x="550" y="1375" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#000">+</text>
  
  <rect x="580" y="1330" width="160" height="80" rx="8" fill="#C8E6C9" stroke="#388E3C" stroke-width="2"/>
  <text x="660" y="1365" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#000000" text-anchor="middle">L_0</text>
  <text x="660" y="1395" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#388E3C" text-anchor="middle">Reconstruction</text>
  
  <text x="400" y="1480" font-family="Times New Roman, serif" font-size="18" font-weight="bold" fill="#6A1B9A" text-anchor="middle">L = L_T + Σ_{t=2}^T L_{t-1} + L_0</text>
  
  <!-- SECTION 3: Loss Terms -->
  <rect x="50" y="1660" width="2100" height="700" rx="12" fill="url(#lossGrad)" stroke="#1565C0" stroke-width="3"/>
  <text x="80" y="1720" font-family="Georgia, serif" font-size="36" font-weight="bold" fill="#000000">2. Understanding Each Loss Term</text>
  
  <!-- Visual breakdown of each term -->
  <!-- L_T -->
  <rect x="100" y="1780" width="620" height="250" rx="10" fill="#FFFFFF" stroke="#D32F2F" stroke-width="2"/>
  <text x="410" y="1820" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#D32F2F" text-anchor="middle">L_T: Prior Matching Term</text>
  
  <rect x="130" y="1860" width="560" height="60" rx="8" fill="#FFEBEE" stroke="#D32F2F" stroke-width="1"/>
  <text x="410" y="1900" font-family="Times New Roman, serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">L_T = D_KL(q(x_T|x₀) || p(x_T))</text>
  
  <text x="140" y="1970" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000">• Measures how close q(x_T|x₀) is to N(0,I)</text>
  <text x="140" y="2000" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#666">• ≈ 0 when schedule is well-designed (no params!)</text>
  
  <!-- L_{t-1} -->
  <rect x="750" y="1780" width="650" height="250" rx="10" fill="#FFFFFF" stroke="#3F51B5" stroke-width="2"/>
  <text x="1075" y="1820" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#3F51B5" text-anchor="middle">L_{t-1}: Denoising Matching Term</text>
  
  <rect x="780" y="1860" width="590" height="60" rx="8" fill="#E8EAF6" stroke="#3F51B5" stroke-width="1"/>
  <text x="1075" y="1900" font-family="Times New Roman, serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">L_{t-1} = D_KL(q(x_{t-1}|x_t,x₀) || p_θ(x_{t-1}|x_t))</text>
  
  <text x="790" y="1970" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000">• Main training signal!</text>
  <text x="790" y="2000" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#666">• Trains network to match true posterior</text>
  
  <!-- L_0 -->
  <rect x="1430" y="1780" width="670" height="250" rx="10" fill="#FFFFFF" stroke="#388E3C" stroke-width="2"/>
  <text x="1765" y="1820" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#388E3C" text-anchor="middle">L_0: Reconstruction Term</text>
  
  <rect x="1460" y="1860" width="610" height="60" rx="8" fill="#E8F5E9" stroke="#388E3C" stroke-width="1"/>
  <text x="1765" y="1900" font-family="Times New Roman, serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">L_0 = -log p_θ(x₀|x₁)</text>
  
  <text x="1470" y="1970" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#000000">• Reconstruction from x₁ to x₀</text>
  <text x="1470" y="2000" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#666">• Often discrete decoder for images</text>
  
  <!-- KL between Gaussians formula -->
  <rect x="100" y="2080" width="2000" height="240" rx="10" fill="#FFFFFF" stroke="#1565C0" stroke-width="2"/>
  <text x="1100" y="2130" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#000000" text-anchor="middle">Key: KL Between Gaussians Has Closed Form!</text>
  
  <rect x="150" y="2160" width="1900" height="70" rx="8" fill="#E3F2FD" stroke="#1565C0" stroke-width="2"/>
  <text x="1100" y="2205" font-family="Times New Roman, serif" font-size="26" font-weight="bold" fill="#000000" text-anchor="middle">D_KL(N(μ₁, σ₁²) || N(μ₂, σ₂²)) = log(σ₂/σ₁) + (σ₁² + (μ₁-μ₂)²)/(2σ₂²) - ½</text>
  
  <text x="1100" y="2290" font-family="Georgia, serif" font-size="22" font-weight="bold" fill="#1565C0" font-style="italic" text-anchor="middle">Since both q(x_{t-1}|x_t,x₀) and p_θ(x_{t-1}|x_t) are Gaussian → closed-form loss!</text>
  
  <!-- SECTION 4: Simplified Loss -->
  <rect x="50" y="2400" width="2100" height="800" rx="12" fill="url(#simplifiedGrad)" stroke="#2E7D32" stroke-width="3"/>
  <text x="80" y="2460" font-family="Georgia, serif" font-size="36" font-weight="bold" fill="#000000">3. The Simplified Training Objective</text>
  
  <!-- Visual: Simplification process -->
  <rect x="100" y="2520" width="900" height="600" rx="10" fill="#FFFFFF" stroke="#2E7D32" stroke-width="2"/>
  <text x="550" y="2570" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#000000" text-anchor="middle">From KL to Simple MSE</text>
  
  <!-- Arrow diagram showing simplification -->
  <rect x="150" y="2620" width="350" height="80" rx="8" fill="#E8EAF6" stroke="#3F51B5" stroke-width="2"/>
  <text x="325" y="2655" font-family="Times New Roman, serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">L_{t-1} = D_KL(q||p_θ)</text>
  <text x="325" y="2685" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666" text-anchor="middle">Complex KL divergence</text>
  
  <line x1="510" y1="2660" x2="590" y2="2660" stroke="#2E7D32" stroke-width="3" marker-end="url(#arrow)"/>
  
  <rect x="600" y="2620" width="350" height="80" rx="8" fill="#C8E6C9" stroke="#2E7D32" stroke-width="2"/>
  <text x="775" y="2655" font-family="Times New Roman, serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">∝ ||μ̃_t - μ_θ||²</text>
  <text x="775" y="2685" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666" text-anchor="middle">Mean matching</text>
  
  <!-- Next step -->
  <line x1="550" y1="2720" x2="550" y2="2780" stroke="#2E7D32" stroke-width="3" marker-end="url(#arrow)"/>
  
  <rect x="300" y="2800" width="500" height="80" rx="8" fill="#A5D6A7" stroke="#2E7D32" stroke-width="2"/>
  <text x="550" y="2835" font-family="Times New Roman, serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">= (β_t²/(2σ_t²α_t(1-ᾱ_t))) ||ε - ε_θ||²</text>
  <text x="550" y="2865" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666" text-anchor="middle">After substitution</text>
  
  <!-- Final step -->
  <line x1="550" y1="2900" x2="550" y2="2960" stroke="#2E7D32" stroke-width="3" marker-end="url(#arrow)"/>
  
  <rect x="200" y="2980" width="600" height="100" rx="8" fill="#66BB6A" stroke="#2E7D32" stroke-width="3"/>
  <text x="500" y="3020" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#FFFFFF" text-anchor="middle">Drop weighting (Ho et al.):</text>
  <text x="500" y="3055" font-family="Times New Roman, serif" font-size="26" font-weight="bold" fill="#FFFFFF" text-anchor="middle">L_simple = ||ε - ε_θ(x_t, t)||²</text>
  
  <!-- Mathematical details on right -->
  <rect x="1050" y="2520" width="1050" height="600" rx="10" fill="#FFFFFF" stroke="#2E7D32" stroke-width="2"/>
  <text x="1575" y="2570" font-family="Arial, sans-serif" font-size="26" font-weight="bold" fill="#000000" text-anchor="middle">Detailed Derivation</text>
  
  <text x="1080" y="2620" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1a1a1a">The posterior mean μ̃_t can be written as:</text>
  <rect x="1100" y="2645" width="950" height="50" rx="5" fill="#E8F5E9" stroke="#2E7D32" stroke-width="1"/>
  <text x="1575" y="2680" font-family="Times New Roman, serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">μ̃_t = (1/√α_t)(x_t - (β_t/√(1-ᾱ_t)) ε)</text>
  
  <text x="1080" y="2740" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1a1a1a">The model predicts mean as:</text>
  <rect x="1100" y="2765" width="950" height="50" rx="5" fill="#E8F5E9" stroke="#2E7D32" stroke-width="1"/>
  <text x="1575" y="2800" font-family="Times New Roman, serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">μ_θ = (1/√α_t)(x_t - (β_t/√(1-ᾱ_t)) ε_θ(x_t,t))</text>
  
  <text x="1080" y="2860" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1a1a1a">Therefore:</text>
  <rect x="1100" y="2885" width="950" height="50" rx="5" fill="#C8E6C9" stroke="#2E7D32" stroke-width="2"/>
  <text x="1575" y="2920" font-family="Times New Roman, serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">||μ̃_t - μ_θ||² = (β_t²/(α_t(1-ᾱ_t))) ||ε - ε_θ||²</text>
  
  <text x="1080" y="2980" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1a1a1a">Ho et al. found dropping the weight works better:</text>
  <rect x="1100" y="3005" width="950" height="80" rx="5" fill="#66BB6A" stroke="#2E7D32" stroke-width="2"/>
  <text x="1575" y="3040" font-family="Times New Roman, serif" font-size="24" font-weight="bold" fill="#FFFFFF" text-anchor="middle">L_simple = E_{t,x₀,ε}[||ε - ε_θ(√ᾱ_t x₀ + √(1-ᾱ_t)ε, t)||²]</text>
  <text x="1575" y="3075" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#FFFFFF" text-anchor="middle">Simple noise prediction MSE!</text>
  
  <!-- SECTION 5: Training Algorithm -->
  <rect x="50" y="3240" width="2100" height="550" rx="12" fill="#FFFFFF" stroke="#333" stroke-width="3"/>
  <text x="80" y="3300" font-family="Georgia, serif" font-size="36" font-weight="bold" fill="#000000">4. Complete Training Algorithm</text>
  
  <rect x="100" y="3350" width="2000" height="400" rx="10" fill="#F5F5F5" stroke="#333" stroke-width="2"/>
  
  <text x="150" y="3400" font-family="Courier New, monospace" font-size="24" font-weight="bold" fill="#6A1B9A">Algorithm: DDPM Training</text>
  <line x1="150" y1="3420" x2="2050" y2="3420" stroke="#CCC" stroke-width="1"/>
  
  <text x="150" y="3460" font-family="Courier New, monospace" font-size="20" font-weight="bold" fill="#000000">1:  repeat</text>
  <text x="150" y="3500" font-family="Courier New, monospace" font-size="20" font-weight="bold" fill="#000000">2:      x₀ ~ q(x₀)                          # Sample data</text>
  <text x="150" y="3540" font-family="Courier New, monospace" font-size="20" font-weight="bold" fill="#000000">3:      t ~ Uniform({1, ..., T})             # Sample timestep</text>
  <text x="150" y="3580" font-family="Courier New, monospace" font-size="20" font-weight="bold" fill="#000000">4:      ε ~ N(0, I)                          # Sample noise</text>
  <text x="150" y="3620" font-family="Courier New, monospace" font-size="20" font-weight="bold" fill="#000000">5:      x_t = √ᾱ_t x₀ + √(1-ᾱ_t) ε           # Create noisy sample</text>
  <text x="150" y="3660" font-family="Courier New, monospace" font-size="20" font-weight="bold" fill="#D32F2F">6:      L = ||ε - ε_θ(x_t, t)||²             # Compute loss</text>
  <text x="150" y="3700" font-family="Courier New, monospace" font-size="20" font-weight="bold" fill="#000000">7:      θ ← θ - η∇_θL                        # Gradient descent</text>
  <text x="150" y="3740" font-family="Courier New, monospace" font-size="20" font-weight="bold" fill="#000000">8:  until converged</text>
  
  <!-- SECTION 6: Weighted Loss Variants -->
  <rect x="50" y="3830" width="2100" height="500" rx="12" fill="url(#elboGrad)" stroke="#6A1B9A" stroke-width="3"/>
  <text x="80" y="3890" font-family="Georgia, serif" font-size="36" font-weight="bold" fill="#000000">5. Loss Weighting Variants</text>
  
  <!-- Visual comparison of weightings -->
  <rect x="100" y="3950" width="650" height="320" rx="10" fill="#FFFFFF" stroke="#6A1B9A" stroke-width="2"/>
  <text x="425" y="3995" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">Simple (DDPM)</text>
  <rect x="130" y="4020" width="590" height="50" rx="5" fill="#E8F5E9" stroke="#2E7D32" stroke-width="2"/>
  <text x="425" y="4055" font-family="Times New Roman, serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">w(t) = 1</text>
  <text x="425" y="4110" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2E7D32" text-anchor="middle">Equal weight for all t</text>
  <!-- Simple line -->
  <line x1="180" y1="4200" x2="680" y2="4200" stroke="#2E7D32" stroke-width="3"/>
  <text x="180" y="4250" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666">t=0</text>
  <text x="680" y="4250" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666">t=T</text>
  
  <rect x="780" y="3950" width="650" height="320" rx="10" fill="#FFFFFF" stroke="#6A1B9A" stroke-width="2"/>
  <text x="1105" y="3995" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">ELBO Weighting</text>
  <rect x="810" y="4020" width="590" height="50" rx="5" fill="#EDE7F6" stroke="#6A1B9A" stroke-width="2"/>
  <text x="1105" y="4055" font-family="Times New Roman, serif" font-size="18" font-weight="bold" fill="#000000" text-anchor="middle">w(t) = β_t²/(2σ_t²α_t(1-ᾱ_t))</text>
  <text x="1105" y="4110" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#6A1B9A" text-anchor="middle">Derived from ELBO</text>
  <!-- Curved line -->
  <path d="M 860 4230 Q 1000 4150 1200 4200 Q 1300 4220 1360 4170" stroke="#6A1B9A" stroke-width="3" fill="none"/>
  <text x="860" y="4250" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666">t=0</text>
  <text x="1360" y="4250" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666">t=T</text>
  
  <rect x="1460" y="3950" width="650" height="320" rx="10" fill="#FFFFFF" stroke="#6A1B9A" stroke-width="2"/>
  <text x="1785" y="3995" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">SNR Weighting</text>
  <rect x="1490" y="4020" width="590" height="50" rx="5" fill="#E3F2FD" stroke="#1565C0" stroke-width="2"/>
  <text x="1785" y="4055" font-family="Times New Roman, serif" font-size="20" font-weight="bold" fill="#000000" text-anchor="middle">w(t) = SNR(t) or 1/SNR(t)</text>
  <text x="1785" y="4110" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#1565C0" text-anchor="middle">Signal-to-noise based</text>
  <!-- Decreasing line -->
  <path d="M 1540 4150 Q 1700 4180 1900 4230" stroke="#1565C0" stroke-width="3" fill="none"/>
  <text x="1540" y="4250" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666">t=0</text>
  <text x="2040" y="4250" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666">t=T</text>
  
  <!-- Summary -->
  <rect x="100" y="4300" width="2000" height="60" rx="8" fill="#D1C4E9" stroke="#6A1B9A" stroke-width="2"/>
  <text x="1100" y="4340" font-family="Georgia, serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">Key Insight: Simple weighting (w=1) works surprisingly well in practice despite being "wrong" theoretically!</text>
  
  <!-- Footer -->
  <rect x="50" y="4370" width="2100" height="80" rx="10" fill="#4A148C" stroke="#4A148C" stroke-width="3"/>
  <text x="1100" y="4425" font-family="Georgia, serif" font-size="28" font-weight="bold" fill="#FFFFFF" text-anchor="middle">Diffusion Theory - Training Objective | From ELBO to Simple MSE Loss</text>
  
  <!-- Key formulas summary -->
  <rect x="50" y="4480" width="2100" height="200" rx="12" fill="#FFFFFF" stroke="#333" stroke-width="3"/>
  <text x="1100" y="4530" font-family="Georgia, serif" font-size="28" font-weight="bold" fill="#000000" text-anchor="middle">Key Formulas Summary</text>
  
  <rect x="100" y="4560" width="650" height="100" rx="8" fill="#E8F5E9" stroke="#2E7D32" stroke-width="2"/>
  <text x="425" y="4600" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2E7D32" text-anchor="middle">Simple Loss (Recommended)</text>
  <text x="425" y="4640" font-family="Times New Roman, serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">L = E[||ε - ε_θ(x_t, t)||²]</text>
  
  <rect x="780" y="4560" width="650" height="100" rx="8" fill="#EDE7F6" stroke="#6A1B9A" stroke-width="2"/>
  <text x="1105" y="4600" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#6A1B9A" text-anchor="middle">ELBO (Theory)</text>
  <text x="1105" y="4640" font-family="Times New Roman, serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">L = L_T + Σ L_{t-1} + L_0</text>
  
  <rect x="1460" y="4560" width="650" height="100" rx="8" fill="#E3F2FD" stroke="#1565C0" stroke-width="2"/>
  <text x="1785" y="4600" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#1565C0" text-anchor="middle">Create Noisy Sample</text>
  <text x="1785" y="4640" font-family="Times New Roman, serif" font-size="22" font-weight="bold" fill="#000000" text-anchor="middle">x_t = √ᾱ_t x₀ + √(1-ᾱ_t) ε</text>
</svg>
