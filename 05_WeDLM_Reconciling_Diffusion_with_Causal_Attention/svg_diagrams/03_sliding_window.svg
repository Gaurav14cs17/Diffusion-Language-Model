<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <linearGradient id="prefixGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3b82f6"/>
      <stop offset="100%" style="stop-color:#2563eb"/>
    </linearGradient>
    <linearGradient id="filledGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#22c55e"/>
      <stop offset="100%" style="stop-color:#16a34a"/>
    </linearGradient>
    <linearGradient id="maskGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#6b7280"/>
      <stop offset="100%" style="stop-color:#4b5563"/>
    </linearGradient>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="500" fill="#1a1a2e"/>
  
  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="#fff" font-size="22" font-weight="bold" font-family="Arial">
    Streaming Parallel Decoding - Sliding Window
  </text>
  
  <!-- Step 0 -->
  <g transform="translate(50, 60)">
    <text x="0" y="15" fill="#888" font-size="14" font-weight="bold" font-family="Arial">Step 0: Initialize</text>
    
    <!-- KV Cache label -->
    <rect x="0" y="30" width="120" height="25" rx="5" fill="#2d2d44"/>
    <text x="60" y="47" text-anchor="middle" fill="#3b82f6" font-size="12" font-family="Arial">KV Cache</text>
    
    <!-- Prefix -->
    <rect x="130" y="30" width="80" height="40" rx="8" fill="url(#prefixGrad)"/>
    <text x="170" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[Prompt]</text>
    
    <!-- Window -->
    <rect x="220" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <rect x="275" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <rect x="330" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <rect x="385" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <text x="245" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    <text x="300" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    <text x="355" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    <text x="410" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    
    <!-- Window bracket -->
    <path d="M 220 75 L 220 85 L 435 85 L 435 75" stroke="#a855f7" stroke-width="2" fill="none"/>
    <text x="327" y="100" text-anchor="middle" fill="#a855f7" font-size="11" font-family="Arial">Window (W=4)</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 470 100 L 470 120 L 480 115 L 470 120 L 460 115" stroke="#fff" stroke-width="2" fill="none"/>
  
  <!-- Step 1 -->
  <g transform="translate(50, 140)">
    <text x="0" y="15" fill="#888" font-size="14" font-weight="bold" font-family="Arial">Step 1: Forward + Fill low entropy</text>
    
    <rect x="0" y="30" width="120" height="25" rx="5" fill="#2d2d44"/>
    <text x="60" y="47" text-anchor="middle" fill="#3b82f6" font-size="12" font-family="Arial">KV Cache</text>
    
    <rect x="130" y="30" width="80" height="40" rx="8" fill="url(#prefixGrad)"/>
    <text x="170" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[Prompt]</text>
    
    <!-- Window with fills -->
    <rect x="220" y="30" width="50" height="40" rx="5" fill="url(#filledGrad)"/>
    <rect x="275" y="30" width="50" height="40" rx="5" fill="url(#filledGrad)"/>
    <rect x="330" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <rect x="385" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <text x="245" y="55" text-anchor="middle" fill="#fff" font-size="10" font-family="Arial">The</text>
    <text x="300" y="55" text-anchor="middle" fill="#fff" font-size="10" font-family="Arial">quick</text>
    <text x="355" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    <text x="410" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    
    <!-- Confidence indicators -->
    <text x="245" y="25" text-anchor="middle" fill="#22c55e" font-size="10" font-family="Arial">âœ“ H=0.2</text>
    <text x="300" y="25" text-anchor="middle" fill="#22c55e" font-size="10" font-family="Arial">âœ“ H=0.3</text>
    <text x="355" y="25" text-anchor="middle" fill="#ef4444" font-size="10" font-family="Arial">âœ— H=0.7</text>
    <text x="410" y="25" text-anchor="middle" fill="#ef4444" font-size="10" font-family="Arial">âœ— H=0.8</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 470 180 L 470 200 L 480 195 L 470 200 L 460 195" stroke="#fff" stroke-width="2" fill="none"/>
  
  <!-- Step 2 -->
  <g transform="translate(50, 220)">
    <text x="0" y="15" fill="#888" font-size="14" font-weight="bold" font-family="Arial">Step 2: Commit prefix, Slide window</text>
    
    <rect x="0" y="30" width="120" height="25" rx="5" fill="#2d2d44"/>
    <text x="60" y="47" text-anchor="middle" fill="#3b82f6" font-size="12" font-family="Arial">KV Cache (updated)</text>
    
    <!-- Extended prefix -->
    <rect x="130" y="30" width="80" height="40" rx="8" fill="url(#prefixGrad)"/>
    <rect x="215" y="30" width="50" height="40" rx="8" fill="url(#prefixGrad)"/>
    <rect x="270" y="30" width="50" height="40" rx="8" fill="url(#prefixGrad)"/>
    <text x="170" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[Prompt]</text>
    <text x="240" y="55" text-anchor="middle" fill="#fff" font-size="10" font-family="Arial">The</text>
    <text x="295" y="55" text-anchor="middle" fill="#fff" font-size="10" font-family="Arial">quick</text>
    
    <!-- Committed indicator -->
    <text x="267" y="20" text-anchor="middle" fill="#22c55e" font-size="12" font-weight="bold" font-family="Arial">âœ“ Committed to KV Cache</text>
    
    <!-- New window position -->
    <rect x="330" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <rect x="385" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <rect x="440" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <rect x="495" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <text x="355" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    <text x="410" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    <text x="465" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    <text x="520" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    
    <!-- Window bracket -->
    <path d="M 330 75 L 330 85 L 545 85 L 545 75" stroke="#a855f7" stroke-width="2" fill="none"/>
    <text x="437" y="100" text-anchor="middle" fill="#a855f7" font-size="11" font-family="Arial">New Window</text>
  </g>
  
  <!-- Arrow -->
  <path d="M 470 260 L 470 280 L 480 275 L 470 280 L 460 275" stroke="#fff" stroke-width="2" fill="none"/>
  
  <!-- Step 3 -->
  <g transform="translate(50, 300)">
    <text x="0" y="15" fill="#888" font-size="14" font-weight="bold" font-family="Arial">Step 3: Forward + Fill + Commit + Slide...</text>
    
    <rect x="0" y="30" width="120" height="25" rx="5" fill="#2d2d44"/>
    <text x="60" y="47" text-anchor="middle" fill="#3b82f6" font-size="12" font-family="Arial">KV Cache (grows)</text>
    
    <rect x="130" y="30" width="260" height="40" rx="8" fill="url(#prefixGrad)"/>
    <text x="260" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[Prompt] The quick brown fox</text>
    
    <rect x="400" y="30" width="50" height="40" rx="5" fill="url(#filledGrad)"/>
    <rect x="455" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <rect x="510" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <rect x="565" y="30" width="50" height="40" rx="5" fill="url(#maskGrad)"/>
    <text x="425" y="55" text-anchor="middle" fill="#fff" font-size="10" font-family="Arial">jumps</text>
    <text x="480" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    <text x="535" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
    <text x="590" y="55" text-anchor="middle" fill="#fff" font-size="11" font-family="Arial">[M]</text>
  </g>
  
  <!-- Key Insight Box -->
  <rect x="50" y="390" width="800" height="100" rx="10" fill="#2d2d44" stroke="#a855f7" stroke-width="2"/>
  <text x="450" y="420" text-anchor="middle" fill="#a855f7" font-size="18" font-weight="bold" font-family="Arial">
    ðŸ’¡ Key Insight: Only consecutive non-masks from start are committed!
  </text>
  <text x="450" y="450" text-anchor="middle" fill="#fff" font-size="14" font-family="Arial">
    Window: [The][quick][MASK][fox] â†’ Commit: [The][quick] only (stop at first MASK)
  </text>
  <text x="450" y="475" text-anchor="middle" fill="#888" font-size="13" font-family="Arial">
    This ensures consistency: committed tokens will never change!
  </text>
</svg>

